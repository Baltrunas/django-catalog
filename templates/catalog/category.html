{% extends 'base.html' %}

{% load static %}

{% load thumbnail %}

{% load bucket %}

{% block content %}

<h1>{% firstof seo.header category.name %}</h1>

{% if category.childs %}
<ul class='b-category_menu'>
	{% for category in category.childs.all %}
		<li class='b-category-menu_item'>
			<a class='b-category-menu_link' href='{{ category.get_absolute_url }}'>
				{% if category.icon %}
					<img class='b-category-menu_icon' src='{{ category.icon.url }}'>
				{% endif %}
				{{ category.name }}
				<span class='times'>({{ category.products_count }})</span>
			</a>
		</li>
	{% endfor %}
</ul><!-- b-category_menu -->
{% endif %}


<div class='b-products'>
	{% for product in category.products.all %}

		<div class='b-product'>
			{% thumbnail product.cover "150x150" crop="center" as im %}
				<img class='b-product__cover' src='{{ im.url }}' alt='{{ product.name }}'>
			{% empty %}
				<img class='b-product__cover' src='{% static "catalog/img/cover-picture.png" %}' alt='{{ product.name }}'>
			{% endthumbnail %}

			<a class='b-product__name' href='{{ product.get_absolute_url }}'>{{ product.name }}</a>

			<div class='b-product__price'>
				<span class='b-product__price_new'>{{ product.retail_price_with_discount|floatformat:0 }}</span>
				{% if product.retail_price_with_discount < product.retail_price %}
					<span class='b-product__price_old'>{{ product.retail_price|floatformat:0 }}</span>
				{% endif %}
			</div>
			<input class='b-btn_number' type='number' name='count' maxlength='3' value='1' min='1' max='{{ product.warehouse_quantity }}'>
			<button class='b-bucket-add b-btn_default'
				data-csrf='{{ csrf_token }}'
				data-content_type='{{ product.get_content_type.id }}'
				data-object_id='{{ product.id }}'
			>
				В корзину
			</button>
			{% in_bucket product as products_in_bucked %}
			<span class='b-in-bucket {% if products_in_bucked %}m-in-bucket_True{% endif %}'>
				<b>В корзине:</b>
				<span class='b-in-bucket__count'>{{ products_in_bucked }}</span>
			</span>
		</div><!-- b-product -->
	{% endfor %}
</div><!-- b-products -->


{% endblock %}